# SQL Scripts

このディレクトリには、データベースのセットアップとメンテナンス用のSQLスクリプトが含まれています。

## ファイル一覧

### `supabase-schema.sql`
- **用途**: データベースの初期セットアップ
- **内容**: 
  - `books`テーブルの作成
  - ASINカラムの追加
  - RLS（Row Level Security）の設定
  - ポリシーの作成
  - インデックスの作成
- **実行タイミング**: プロジェクト初期設定時

### `update-existing-asin.sql`
- **用途**: 既存データのASINカラム初期化
- **内容**:
  - 既存データのASINを空文字列で初期化
  - 確認用クエリ
- **実行タイミング**: 既存データがある場合の移行時

### `add-delete-policies.sql`
- **用途**: 削除・更新用のRLSポリシー追加
- **内容**:
  - 更新用ポリシーの追加
  - 削除用ポリシーの追加
  - 現在のポリシー確認クエリ
- **実行タイミング**: 削除機能が動作しない場合

### `check-policies.sql`
- **用途**: 現在のRLSポリシー状況を確認
- **内容**:
  - RLSの有効/無効状態確認
  - ポリシー一覧の表示
  - 現在のユーザー情報確認
- **実行タイミング**: 問題の診断時

### `temp-disable-rls.sql`
- **用途**: 一時的にRLSを無効化してテスト
- **内容**:
  - RLSの無効化
  - 状態確認
- **実行タイミング**: ポリシー問題の診断時（本番環境では使用禁止）

### `reenable-rls.sql`
- **用途**: RLSを再有効化し、適切なポリシーを設定
- **内容**:
  - RLSの有効化
  - 全ポリシーの再作成
  - 状態確認
- **実行タイミング**: テスト後の復旧時

## 実行手順

1. **新規プロジェクトの場合**:
   ```sql
   -- supabase-schema.sql を実行
   ```

2. **既存データがある場合**:
   ```sql
   -- 1. supabase-schema.sql を実行
   -- 2. update-existing-asin.sql を実行
   ```

## 注意事項

- 本番環境で実行する前に、必ずテスト環境で動作確認を行ってください
- 既存データがある場合は、バックアップを取ってから実行してください
